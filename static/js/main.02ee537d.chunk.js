(this["webpackJsonpab-test-web"]=this["webpackJsonpab-test-web"]||[]).push([[0],{122:function(e,t,a){},123:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(16),l=a.n(s),c=a(9),o=a(69),i=a(10),u=a(7),_=a.n(u),d=a(11),m=a(14),p=a(6),f=a(13),h=a(33),b=a.n(h);function y(e){return{type:"SET_SHOW_RECORD_BUTTON_STATE",showRecordButton:e}}function v(e){return{type:"SET_SHOW_PLAY_LIST_STATE",showPlayList:e}}function E(e,t){return{type:"SET_DRAWER_STATE",side:e,open:t}}var x=Object({NODE_ENV:"production",PUBLIC_URL:"/ab-test-web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_API_SERVER:"https://ab-test-api.appspot.com",REACT_APP_STADIA_MAP_API_KEY:"dc0409eb-addb-404f-a42a-39867c49e57f",REACT_APP_URL_PREFIX:"/ab-test-web"}),g=x.REACT_APP_API_SERVER,O=x.REACT_APP_STADIA_MAP_API_KEY,S=x.REACT_APP_URL_PREFIX,w="https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png?api_key=".concat(O),z={center:[22.2988,114.1722],zoom:12,zoomSnap:.1,zoomDelta:.5,zoomControl:!1,doubleClickZoom:!1},j=a(53),R=a.n(j),T=Object(c.c)((function(e){return{activeThread:e.threads.activeThread,threads:e.threads.threads,drawerState:e.components.drawerState,geolocation:e.geolocation.geolocation}}),(function(e){return{setDrawerState:function(t,a){return e(E(t,a))},setShowRecordButtonState:function(t){return e(y(t))},setShowPlayListState:function(t){return e(v(t))}}}))((function(e){var t=e.activeThread,a=e.threads,s=e.geolocation,l=e.setDrawerState,c=e.setShowRecordButtonState,o=e.setShowPlayListState,u=Object(n.useRef)(null),_=Object(n.useRef)(null),d=Object(n.useRef)(null),h=Object(n.useRef)(null),y=Object(n.useState)({}),v=Object(f.a)(y,2),E=v[0],x=v[1],g=Object(i.g)();return Object(n.useEffect)((function(){var e=b.a.DomUtil.get("map");e&&(e._leaflet_id=null);var t=b.a.tileLayer(w,{className:R.a["tile-layer"],attribution:'\n  &copy; <a href="https://stadiamaps.com/">Stadia Maps</a>,\n  &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a>\n  &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>\n  contributors\n'}),a=Object(p.a)(Object(p.a)({},z),{},{layers:[t]});u.current=b.a.map("map",a),_.current=b.a.layerGroup().addTo(u.current),d.current=b.a.layerGroup().addTo(u.current)}),[]),Object(n.useEffect)((function(){_.current.clearLayers();var e=b.a.divIcon({className:R.a.thread});a.forEach((function(t){var a=b.a.latLng([t.location._latitude,t.location._longitude]),n=b.a.popup({className:R.a.popup,closeButton:!1,pane:"shadowPane"}),r=b.a.marker(a,{icon:e}).bindPopup(n).on("popupopen",(function(){u.current.flyTo(a),o(!1),c(!1),l("bottom",!0);var e="".concat(S,"/threads/").concat(t.id);g.push(e)})).on("popupclose",(function(){h.current=null,c(!0),l("bottom",!1);var e=S;g.push(e)})).addTo(_.current);x((function(e){return Object(p.a)(Object(p.a)({},e),{},Object(m.a)({},t.id,r))}))}))}),[a,g,l,c,o]),Object(n.useEffect)((function(){if(s){var e=b.a.divIcon({className:R.a["new-thread"]}),t=b.a.latLng([s._latitude,s._longitude]);h.current=b.a.marker(t,{icon:e}).addTo(d.current),u.current.flyTo(t)}else d.current&&d.current.clearLayers()}),[s]),Object(n.useEffect)((function(){t?(h.current=E[t.id],h.current.isPopupOpen()||h.current.openPopup()):h.current&&h.current.closePopup()}),[t]),r.a.createElement("div",{id:"map",className:R.a.map})})),N=a(144),A=a(147),k=a(148),P=a(149),D=a(125),I=a(66),L=a(48),C=a(35),B=a.n(C),G=Object(c.c)((function(e){return{channel:e.channels.channel,drawerState:e.components.drawerState}}),(function(e){return{setDrawerState:function(t,a){return e(E(t,a))},setShowRecordButtonState:function(t){return e(y(t))}}}))((function(e){return r.a.createElement(N.a,{className:B.a["head-nav"],position:"absolute"},r.a.createElement(A.a,null,r.a.createElement(k.a,{className:"".concat(B.a.menu," ").concat(B.a["nav-menu"]),edge:"start",color:"inherit","aria-label":"menu",onClick:function(){var t=!e.drawerState.left;e.setDrawerState("left",t)}},r.a.createElement(L.c,null)),r.a.createElement(P.a,{className:B.a.switch},r.a.createElement(D.a,{className:"".concat(B.a.prev," ").concat(B.a["stage-previous"]),"aria-label":"previous"},r.a.createElement(L.a,null)),r.a.createElement(D.a,{className:B.a.stage,color:"inherit"},e.channel),r.a.createElement(D.a,{className:"".concat(B.a.next," ").concat(B.a["stage-next"]),"aria-label":"next"},r.a.createElement(L.b,null))),r.a.createElement(k.a,{className:"".concat(B.a.search," ").concat(B.a["nav-search"]),edge:"end",color:"inherit","aria-label":"search"},r.a.createElement(I.a,null))))})),U=a(8);function V(e){return{type:"SET_AUDIO",audio:e}}function W(e){return{type:"SET_IS_RECORDING_STATE",isRecording:e}}var F=a(43),H=a.n(F),M=Object(c.c)((function(e){return{recorder:e.audios.recorder,isRecording:e.audios.isRecording,activeThread:e.threads.activeThread}}),(function(e){return{setAudio:function(t){return e(V(t))},setIsRecordingState:function(t){return e(W(t))},setShowRecordButtonState:function(t){return e(y(t))}}}))((function(e){var t,a=Object(n.useState)(0),s=Object(f.a)(a,2),l=s[0],c=s[1],o=Object(i.g)(),u=Object(i.h)(),p=function(){if(e.isRecording)e.setIsRecordingState(!1);else{var t="".concat(S,"/threads").concat(e.activeThread?"/".concat(e.activeThread.id):"","/new");o.push(t)}},h=function(){var t=Object(d.a)(_.a.mark((function t(){var a;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(n=e.recorder)?n.stop():null;case 2:(a=t.sent)&&u.pathname!==S&&(e.setAudio(a),e.setShowRecordButtonState(!1));case 4:case"end":return t.stop()}var n}),t)})));return function(){return t.apply(this,arguments)}}();return function(e,t){var a=Object(n.useRef)(!1);Object(n.useEffect)((function(){a.current?e():a.current=!0}),t)}((function(){var t;e.isRecording?(t=e.recorder)?t.start():console.log("recorder is not ready!"):h()}),[e.isRecording]),r.a.createElement("div",{className:Object(U.a)((t={},Object(m.a)(t,H.a["record-button"],!0),Object(m.a)(t,H.a.show,e.showRecordButton),t))},r.a.createElement(k.a,{id:"record",className:H.a.button,"aria-label":"record",onDoubleClick:p,onTouchStart:function(e){e.preventDefault();var t=(new Date).getTime(),a=function(e){return e-l<600}(t);if(c(t),a)return p()},onContextMenu:function(e){return e.preventDefault()}},"9up"))})),J=a(150),Z=a(76),Y=a.n(Z),q=Object(c.c)((function(e){return{drawerState:e.components.drawerState}}),(function(e){return{setDrawerState:function(t,a){return e(E(t,a))}}}))((function(e){var t,a=e.side,n=e.drawerState,s=e.disableSwipe,l=e.children,c=e.setDrawerState,o=function(e,t){return function(a){(!a||"keydown"!==a.type||"Tab"!==a.key&&"Shift"!==a.key)&&c(e,t)}};return r.a.createElement(J.a,{anchor:a,open:n[a],disableSwipeToOpen:s,onClose:o(a,!1),onOpen:o(a,!0),className:Object(U.a)((t={},Object(m.a)(t,Y.a.drawer,!0),Object(m.a)(t,Y.a["drawer-horizontal"],"left"===a||"right"===a),t))},l)})),K=a(36),Q=a(61),X=a.n(Q),$=Object(c.c)((function(e){return{}}),(function(e){return{setShowRecordButtonState:function(t){return e(y(t))}}}))((function(e){return Object(n.useEffect)((function(){return e.setShowRecordButtonState(!1),function(){e.setShowRecordButtonState(!0)}}),[]),r.a.createElement("div",{className:X.a.left},r.a.createElement("div",{className:X.a.container},r.a.createElement(K.a,{className:X.a.link,to:"".concat(S,"/login")},r.a.createElement("button",{className:X.a.button},"\u767b\u5165"))))})),ee=a(31),te=a(86),ae=a(87),ne=a.n(ae);function re(e){var t=e._seconds,a=e._nanoseconds,n=new te.firestore.Timestamp(t,a);return ne()(n.toDate()).fromNow()}function se(){var e=Date.now(),t=Math.floor(e/1e3);return{_seconds:t,_nanoseconds:1e6*(e-1e3*t)}}var le=a(40),ce=a.n(le),oe=Object(c.c)((function(e){return{users:e.users.users}}),(function(e){return{}}))((function(e){var t,a,s,l=Object(n.useState)(!1),c=Object(f.a)(l,2),o=c[0],i=c[1],u=document.createElement("audio");u.src=e.voice.voice_url;var _=Object(n.useRef)(u);return r.a.createElement("div",{className:ce.a["voice-info"]},r.a.createElement(k.a,{className:ce.a.profile,"aria-label":"profile"},r.a.createElement(ee.g,null),r.a.createElement("span",{className:ce.a.badge},null===(t=e.users.find((function(t){return t.id===e.voice.user_id.split("/")[1]})))||void 0===t||null===(a=t.followers)||void 0===a?void 0:a.length,"+")),r.a.createElement("div",{className:ce.a.info},r.a.createElement("p",{className:ce.a.date},re(e.voice.timestamp)),r.a.createElement("h3",{className:ce.a.user,onClick:function(){o?_.current.pause():_.current.play(),i((function(e){return!e}))}},null===(s=e.users.find((function(t){return t.id===e.voice.user_id.split("/")[1]})))||void 0===s?void 0:s.username)),r.a.createElement(k.a,{className:ce.a.like,"aria-label":"like"},r.a.createElement(ee.e,null),r.a.createElement("span",{className:ce.a.badge},e.voice.liked_by_users.length,"+")))})),ie=a(71),ue=a.n(ie),_e=Object(c.c)((function(e){return{voices:e.voices.voices}}),(function(e){return{}}))((function(e){var t;return r.a.createElement("div",{className:Object(U.a)((t={},Object(m.a)(t,ue.a["play-list"],!0),Object(m.a)(t,ue.a.open,e.open),t))},r.a.createElement("ul",{className:ue.a.voices},e.voices.map((function(e,t){return r.a.createElement("li",{key:t},r.a.createElement(oe,{voice:e}))}))))}));function de(e){return{type:"CREATE_THREAD",newThread:e}}function me(e){return{type:"SET_ACTIVE_THREAD",activeThread:e}}function pe(e,t){return{type:e,msg:t}}function fe(e,t){return{type:e,msg:t}}function he(e){return function(){var t=Object(d.a)(_.a.mark((function t(a){var n,r,s,l;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(g,"/voices?thread_id=").concat(e),{method:"GET"});case 2:return n=t.sent,t.next=5,n.json();case 5:r=t.sent,s=r.isSuccess,l=r.data,a(s?{type:"LOAD_VOICES",voices:l}:fe("LOAD_VOICES_FAILED",l));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}var be=a(34),ye=a.n(be),ve=Object(c.c)((function(e){return{users:e.users.users,voices:e.voices.voices,threadPlaying:e.threads.threadPlaying,showPlayList:e.components.showPlayList}}),(function(e){return{setDrawerState:function(t,a){return e(E(t,a))},setActiveThread:function(t){return e(me(t))},loadVoices:function(t){return e(he(t))},stopPlayingThread:function(){return e({type:"STOP_PLAYING_THREAD"})},toggleThreadPlaying:function(){return e({type:"TOGGLE_THREAD_PLAYING"})},setShowPlayListState:function(t){return e(v(t))},setShowRecordButtonState:function(t){return e(y(t))}}}))((function(e){var t,a=function(){var t=!e.showPlayList;e.setShowPlayListState(t),e.setShowRecordButtonState(t)};return Object(n.useEffect)((function(){e.stopPlayingThread(),e.setActiveThread(e.thread),e.loadVoices(e.thread.id)}),[]),r.a.createElement("div",{className:ye.a["thread-panel"]},r.a.createElement("div",{className:ye.a.container},r.a.createElement("div",{className:ye.a.handle,onClick:a}),r.a.createElement("div",{className:ye.a.contents},r.a.createElement("h2",{className:ye.a.title,onClick:a},e.thread.title),r.a.createElement("p",{className:ye.a.info},null===(t=e.users.find((function(t){return t.id===e.thread.user_id.split("/")[1]})))||void 0===t?void 0:t.username,"\u30fb",re(e.thread.timestamp)),r.a.createElement("div",{className:ye.a.control},r.a.createElement(k.a,{className:ye.a["control-star"],color:"inherit","aria-label":"star"},r.a.createElement(ee.f,null)),r.a.createElement(k.a,{className:ye.a["thread-previous"],color:"inherit","aria-label":"previous"},r.a.createElement(L.e,null)),r.a.createElement(k.a,{className:ye.a["thread-play"],color:"inherit","aria-label":"play",onClick:function(){e.setShowPlayListState(!0),e.setShowRecordButtonState(!0),e.toggleThreadPlaying()}},e.threadPlaying?r.a.createElement(ee.c,null):r.a.createElement(ee.d,null)),r.a.createElement(k.a,{className:ye.a["thread-next"],color:"inherit","aria-label":"next"},r.a.createElement(L.d,null)),r.a.createElement(k.a,{className:ye.a["control-share"],color:"inherit","aria-label":"share"},r.a.createElement(I.b,null))),r.a.createElement(_e,{open:e.showPlayList}))))})),Ee=a(92),xe=Object(c.c)((function(e){return{threads:e.threads.threads}}),(function(e){return{}}))((function(e){var t=e.component,a=e.threads,n=Object(Ee.a)(e,["component","threads"]),s=Object(i.i)({path:"".concat(S,"/threads/:threadId")}),l=(null===s||void 0===s?void 0:s.params).threadId,c=a.find((function(e){return e.id===l})),o=t;return r.a.createElement(i.b,Object.assign({},n,{render:function(){return c?r.a.createElement(o,{thread:c}):r.a.createElement(i.a,{to:S})}}))})),ge=a(54),Oe=a.n(ge),Se=Object(c.c)((function(e){return{isRecording:e.audios.isRecording}}),(function(e){return{setIsRecordingState:function(t){return e(W(t))}}}))((function(e){var t=Object(n.useState)(0),a=Object(f.a)(t,2),s=a[0],l=a[1],c=function(e,t,a){return e.toString().padStart(4,"0").substring(t,a)};return Object(n.useEffect)((function(){var t=setInterval((function(){s>=e.limit?e.setIsRecordingState(!1):l((function(e){return e+1}))}),10);return function(){clearInterval(t),e.isRecording&&e.setIsRecordingState(!1)}}),[]),r.a.createElement("div",{className:Oe.a["timer-bar"]},r.a.createElement("h2",{className:Oe.a.timer},r.a.createElement("span",{className:Oe.a.second},c(s,0,2)),r.a.createElement("span",{className:Oe.a.colon},":"),r.a.createElement("span",{className:Oe.a.centisecond},c(s,2))))})),we=a(68),ze=a(88),je=a(55),Re=a.n(je),Te=Object(c.c)((function(e){return{}}),(function(e){return{setAudio:function(t){return e(V(t))}}}))((function(e){var t=Object(n.useState)(!1),a=Object(f.a)(t,2),s=a[0],l=a[1],c=new Audio(e.audioUrl);c.addEventListener("ended",(function(){return l(!1)}));return r.a.createElement("div",{className:Re.a["audio-player"]},r.a.createElement("div",{className:Re.a.control},r.a.createElement(k.a,{className:Re.a.play,"aria-label":"play",onClick:function(e){s?c.pause():c.play(),l(!s)}},s?r.a.createElement(ee.c,null):r.a.createElement(ee.d,null)),r.a.createElement("div",{className:Re.a["wave-form"]},"WaveForm"),r.a.createElement(k.a,{className:Re.a.delete,"aria-label":"delete",onClick:function(){return e.setAudio(null)}},r.a.createElement(ze.a,null))))})),Ne=Object(c.c)((function(e){return{}}),(function(e){return{setIsRecordingState:function(t){return e(W(t))},setShowRecordButtonState:function(t){return e(y(t))}}}))((function(e){return r.a.createElement("div",{className:Object(U.a)(H.a["record-button"],H.a.embedded)},r.a.createElement(D.a,{id:"record",className:H.a.button,"aria-label":"record",onClick:function(){e.setShowRecordButtonState(!0),e.setIsRecordingState(!0)},onContextMenu:function(e){return e.preventDefault()}},"\u958b\u59cb\u9304"))})),Ae=a(89);function ke(e){return{type:"SET_GEOLOCATION",geolocation:e}}var Pe=a(22),De=a.n(Pe),Ie=Object(c.c)((function(e){return{audio:e.audios.audio,geolocation:e.geolocation.geolocation,drawerState:e.components.drawerState}}),(function(e){return{createThread:function(t){return e(function(e){return function(){var t=Object(d.a)(_.a.mark((function t(a){var n,r,s,l;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(g,"/threads"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)});case 2:return n=t.sent,t.next=5,n.json();case 5:if(r=t.sent,s=r.isSuccess,l=r.data,!s){t.next=13;break}return a(de(l)),t.abrupt("return",l);case 13:return a(pe("CREATE_THREAD_FAILED",l)),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t))},createVoice:function(t,a){return e(function(e,t){var a=JSON.stringify(e),n=new FormData;return n.append("voice_string",a),n.append("audio_blob",t),function(){var e=Object(d.a)(_.a.mark((function e(t){var a,r,s,l;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(g,"/voices"),{method:"POST",body:n});case 2:return a=e.sent,e.next=5,a.json();case 5:if(r=e.sent,s=r.isSuccess,l=r.data,!s){e.next=12;break}return e.abrupt("return",l);case 12:t(fe("CREATE_VOICE_FAILED",l));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(t,a))},setGeolocation:function(t){return e(ke(t))},loadVoices:function(t){return e(he(t))},setShowRecordButtonState:function(t){return e(y(t))}}}))((function(e){var t=Object(n.useState)(!0),a=Object(f.a)(t,2),s=a[0],l=a[1],c=Object(we.a)(),o=c.register,u=c.handleSubmit,m=Object(n.useRef)(null),p=Object(i.g)(),h=Object(n.useState)(e.thread?e.thread.title:""),b=Object(f.a)(h,2),y=b[0],v=b[1],E=function(){var t=Object(d.a)(_.a.mark((function t(a){var n,r,s,l,c,o,i,u,d,m,f,h,b;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.audio){t.next=29;break}if(n=a.threadTitle,r=se(),s=e.geolocation){t.next=6;break}return t.abrupt("return",console.log("Location is not available!"));case 6:if(l="",e.thread){t.next=15;break}return c={is_active:!0,title:n,user_id:"Z1aO565FJD1ZmaOqI9Mi",color_code:"Y",bookmarked_by_users:[],location:s,timestamp:r},t.next=11,e.createThread(c);case 11:o=t.sent,l=o.id,t.next=16;break;case 15:l=e.thread.id;case 16:return i=e.audio,u=i.audioUrl,d=i.audioBlob,m={is_active:!0,thread_id:l,user_id:"Z1aO565FJD1ZmaOqI9Mi",voice_url:u,liked_by_users:[],location:s,timestamp:r},t.next=20,e.createVoice(m,d);case 20:f=t.sent,h=f.thread_id,e.setGeolocation(null),b="".concat(S,"/").concat(h),p.push(b),e.loadVoices(l),e.setShowRecordButtonState(!0),t.next=30;break;case 29:console.log("No voice has been recorded yet!");case 30:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(n.useEffect)((function(){m.current&&!e.thread&&m.current.focus()}),[]),Object(n.useEffect)((function(){e.audio&&l(!1)}),[e.audio]),r.a.createElement("div",{className:De.a["voice-form"]},r.a.createElement("div",{className:De.a.container},r.a.createElement("div",{className:De.a.handle}),r.a.createElement("form",{id:"voice-form",className:De.a.form,onSubmit:u(E)},r.a.createElement("ul",{className:De.a.fields},e.thread?null:r.a.createElement("li",{className:De.a.field},r.a.createElement("label",{className:De.a.label,htmlFor:"channel"},"\u9078\u64c7\u7248\u5340\uff1a"),r.a.createElement("select",{className:De.a.select,name:"channel",ref:o},r.a.createElement("option",{className:De.a.option,value:"\u5439\u6c34\u53f0"},"\u5439\u6c34\u53f0"))),r.a.createElement("li",{className:De.a.field},r.a.createElement("label",{className:De.a.label,htmlFor:"thread"},"".concat(e.thread?"\u56de\u61c9":"\u65b0\u8cbc","\u984c\u76ee\uff1a")),r.a.createElement("input",{className:De.a.input,name:"threadTitle",ref:function(e){o(e,{required:!0}),m.current=e},type:"text",value:y,onChange:function(e){return v(e.target.value)},readOnly:Boolean(e.thread)}))),s?r.a.createElement("div",{className:De.a.loading},"Loading Audio..."):e.audio?r.a.createElement(Te,{audioUrl:e.audio.audioUrl}):r.a.createElement(Ne,null),r.a.createElement("div",{className:De.a.control},r.a.createElement("div",{className:De.a.buttons},r.a.createElement(k.a,{className:De.a.new,"aria-label":"new"},r.a.createElement(Ae.a,null)),r.a.createElement(k.a,{className:De.a.music,"aria-label":"music"},r.a.createElement(ee.b,null))),r.a.createElement(k.a,{className:De.a.submit,"aria-label":"submit",type:"submit",form:"voice-form"},r.a.createElement(ee.a,null))))))}));var Le=Object(c.c)((function(e){return{isRecording:e.audios.isRecording}}),(function(e){return{setIsRecordingState:function(t){return e(W(t))},setGeolocation:function(t){return e(ke(t))}}}))((function(e){var t=Object(i.h)(),a=Object(n.useState)(null),s=Object(f.a)(a,2),l=s[0],c=s[1];return Object(n.useEffect)((function(){e.setIsRecordingState(!0);var t=function(e){var t,a=window.navigator.geolocation;return a?t=a.watchPosition((function(n){var r=function(e){var t=e.coords;return{_latitude:t.latitude,_longitude:t.longitude}}(n);e(r),a.clearWatch(t)}),(function(e){var t=e.code,a=e.message;return console.log("ERROR(".concat(t,"): ").concat(a))})):(console.log("Geolocation is not supported!"),null)}(c);return function(){!function(e){var t=window.navigator.geolocation;t&&e&&t.clearWatch(e)}(t),e.setGeolocation(null)}}),[]),Object(n.useEffect)((function(){!e.isRecording&&t.pathname.endsWith("/new")&&e.setGeolocation(l)}),[e.isRecording]),e.isRecording?r.a.createElement(Se,{limit:e.thread?900:9900}):r.a.createElement(Ie,{thread:e.thread})})),Ce=function(){var e=Object(i.g)();return Object(n.useEffect)((function(){return function(){var t=S;e.push(t)}}),[]),r.a.createElement("div",null,r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"".concat(S,"/threads/new"),children:r.a.createElement(Le,{thread:null})}),r.a.createElement(xe,{path:"".concat(S,"/threads/:threadId/new"),component:Le}),r.a.createElement(xe,{path:"".concat(S,"/threads/:threadId"),component:ve})))};var Be=a(77),Ge=a.n(Be),Ue=Object(c.c)((function(e){return{threads:e.threads.threads,activeThread:e.threads.activeThread,showRecordButton:e.components.showRecordButton}}),(function(e){return{loadThreads:function(){return e(function(){var e=Object(d.a)(_.a.mark((function e(t){var a,n,r,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(g,"/threads"),{method:"GET"});case 2:return a=e.sent,e.next=5,a.json();case 5:n=e.sent,r=n.isSuccess,s=n.data,t(r?{type:"LOAD_THREADS",threads:s}:pe("LOAD_THREADS_FAILED",s));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},loadUsers:function(){return e(function(){var e=Object(d.a)(_.a.mark((function e(t){var a,n,r,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(g,"/users"),{method:"GET"});case 2:return a=e.sent,e.next=5,a.json();case 5:n=e.sent,r=n.isSuccess,s=n.data,t(r?{type:"LOAD_USERS",users:s}:{type:"LOAD_USERS_FAILED",msg:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},setRecorder:function(t){return e(function(e){return{type:"SET_RECORDER",recorder:e}}(t))},setActiveThread:function(t){return e(me(t))},setShowRecordButtonState:function(t){return e(y(t))},setDrawerState:function(t,a){return e(E(t,a))}}}))((function(e){var t=Object(i.h)(),a=function(){var t=Object(d.a)(_.a.mark((function t(){var a;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise(function(){var e=Object(d.a)(_.a.mark((function e(t){var a,n,r,s,l;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:a=e.sent,n=new MediaRecorder(a),s=function(e){r=e.data},n.addEventListener("dataavailable",s),l=function(){return new Promise((function(e){n.addEventListener("stop",(function(){var t=new Blob([r]),a=URL.createObjectURL(t);e({audioBlob:t,audioUrl:a})})),n.stop()}))},t({start:function(){return n.start()},stop:l});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:a=t.sent,e.setRecorder(a);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(n.useEffect)((function(){a(),e.loadThreads(),e.loadUsers()}),[]),Object(n.useEffect)((function(){t.pathname===S?(e.setShowRecordButtonState(!0),e.setDrawerState("bottom",!1),e.activeThread&&e.setActiveThread(null)):e.setDrawerState("bottom",!0)}),[t]),e.threads.length?r.a.createElement("div",{className:Ge.a.main},r.a.createElement(T,null),r.a.createElement(G,null),r.a.createElement(q,{side:"left"},r.a.createElement($,null)),r.a.createElement(q,{side:"bottom",disableSwipe:null===e.activeThread},r.a.createElement(Ce,null)),r.a.createElement(M,{showRecordButton:e.showRecordButton})):r.a.createElement("div",{className:Ge.a.loading},"Loading...")})),Ve=a(37),We=a.n(Ve),Fe=function(){var e=Object(we.a)(),t=e.register,a=e.handleSubmit,s=Object(n.useState)(""),l=Object(f.a)(s,2),c=l[0],o=l[1],i=Object(n.useState)(""),u=Object(f.a)(i,2),_=u[0],d=u[1],m=function(e){return function(t){var a;switch(e){case"email":a=o;break;case"password":a=d;break;default:return console.log("Incorrect handleInput key"),console.log({key:e,value:t.target.value})}a(t.target.value)}};return r.a.createElement("form",{id:"login",className:We.a.form,onSubmit:a((function(e){e.preventDefault(),console.log({e:e})}))},r.a.createElement("h1",{className:We.a.title},"\u767b\u5165"),r.a.createElement("ul",{className:We.a.fields},r.a.createElement("li",{className:We.a.field},r.a.createElement("label",{className:We.a.label,htmlFor:"email"},"\u767b\u5165\u96fb\u90f5"),r.a.createElement("input",{className:We.a.input,type:"email",name:"email",ref:t,value:c,onChange:m("email")})),r.a.createElement("li",{className:We.a.field},r.a.createElement("label",{className:We.a.label,htmlFor:"email"},"\u5bc6\u78bc"),r.a.createElement("input",{className:We.a.input,type:"password",name:"password",ref:t,value:_,onChange:m("password")}))),r.a.createElement("button",{className:We.a.button,type:"submit",form:"login"},"\u78ba\u8a8d"))},He=[{key:"email",text:"Sign up with email"},{key:"facebook",text:"Sign up with facebook"},{key:"google",text:"Sign up with Google+"}],Me=a(30),Je=a.n(Me),Ze=function(){return r.a.createElement("div",{className:Je.a.auth},r.a.createElement("div",{className:Je.a.background}),r.a.createElement("div",{className:Je.a.container},r.a.createElement("div",{className:Je.a.header},r.a.createElement("div",{className:Je.a.wrapper},r.a.createElement("img",{className:Je.a.logo,src:"".concat(S,"/logo.svg"),alt:"9UP"})),r.a.createElement("p",{className:Je.a.text},"Talk to the World")),r.a.createElement(Fe,null),r.a.createElement("div",{className:Je.a.links},He.map((function(e){var t=e.key,a=e.text;return r.a.createElement(K.a,{className:Je.a.link,to:"".concat(S,"/register/").concat(t)},r.a.createElement("button",{className:Je.a.button},r.a.createElement("div",{className:Je.a.wrapper},r.a.createElement("img",{className:Je.a.icon,src:"".concat(S,"/icons/").concat(t,".svg"),alt:a})),r.a.createElement("span",{className:Je.a.text},a)))})))))},Ye=a(90),qe=a.n(Ye),Ke=function(){return r.a.createElement("div",{className:qe.a.app},r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/",exact:!0,component:function(){return r.a.createElement(i.a,{to:S})}}),r.a.createElement(i.b,{path:"".concat(S,"/login"),component:Ze}),r.a.createElement(i.b,{path:S,component:Ue})))},Qe=a(42),Xe=a(29),$e=a(81),et=a(91),tt={threads:[],activeThread:null,threadPlaying:!1},at={voices:[]},nt={users:[]},rt={recorder:null,audio:null,isRecording:!1},st={geolocation:null},lt={channel:"\u5439\u6c34\u53f0"},ct={showRecordButton:!0,showPlayList:!1,drawerState:{top:!1,right:!1,bottom:!1,left:!1}};var ot=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Qe.d,it=Object(Xe.a)(),ut=Object(Qe.c)({threads:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_THREADS":var a=t.threads;return Object(p.a)(Object(p.a)({},e),{},{threads:a});case"CREATE_THREAD":var n=t.newThread,r=e.threads.concat(n);return Object(p.a)(Object(p.a)({},e),{},{threads:r});case"SET_ACTIVE_THREAD":var s=t.activeThread;return Object(p.a)(Object(p.a)({},e),{},{activeThread:s});case"TOGGLE_THREAD_PLAYING":var l=!e.threadPlaying;return Object(p.a)(Object(p.a)({},e),{},{threadPlaying:l});case"STOP_PLAYING_THREAD":return Object(p.a)(Object(p.a)({},e),{},{threadPlaying:!1});default:return e}},voices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_VOICES":var a=t.voices;return Object(p.a)(Object(p.a)({},e),{},{voices:a});default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_USERS":var a=t.users;return Object(p.a)(Object(p.a)({},e),{},{users:a});default:return e}},audios:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_RECORDER":var a=t.recorder;return Object(p.a)(Object(p.a)({},e),{},{recorder:a});case"SET_AUDIO":var n=t.audio;return Object(p.a)(Object(p.a)({},e),{},{audio:n});case"SET_IS_RECORDING_STATE":var r=t.isRecording;return Object(p.a)(Object(p.a)({},e),{},{isRecording:r});default:return e}},geolocation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:st,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GEOLOCATION":var a=t.geolocation;return Object(p.a)(Object(p.a)({},e),{},{geolocation:a});default:return e}},channels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CHANNEL":var a=t.channel;return Object(p.a)(Object(p.a)({},e),{},{channel:a});default:return e}},components:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ct,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SHOW_RECORD_BUTTON_STATE":var a=t.showRecordButton;return Object(p.a)(Object(p.a)({},e),{},{showRecordButton:a});case"SET_SHOW_PLAY_LIST_STATE":var n=t.showPlayList;return Object(p.a)(Object(p.a)({},e),{},{showPlayList:n});case"SET_DRAWER_STATE":var r=t.side,s=t.open,l=e.drawerState;return Object(p.a)(Object(p.a)({},e),{},{drawerState:Object(p.a)(Object(p.a)({},l),{},Object(m.a)({},r,s))});default:return e}},router:Object(o.b)(it)}),_t=Object(Qe.e)(ut,ot(Object(Qe.a)(et.a),Object(Qe.a)(Object($e.a)(it))));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(122);l.a.render(r.a.createElement(c.a,{store:_t},r.a.createElement(o.a,{history:it},r.a.createElement(Ke,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},22:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__ijZIq","text-size-small":"styles_text-size-small__1lNhe","text-size-normal":"styles_text-size-normal__3tbWC","text-size-large":"styles_text-size-large__jaA8s","text-size-larger":"styles_text-size-larger__3cF7A","text-bold":"styles_text-bold__38hor","text-uppercase":"styles_text-uppercase__xPWzx","voice-form":"styles_voice-form__3gLiu",container:"styles_container__zAavQ",handle:"styles_handle__ZPzTV",form:"styles_form__3CGWh",fields:"styles_fields__1ASB4",field:"styles_field__2_bzl",label:"styles_label__lRzte",select:"styles_select__3NPIu",input:"styles_input__k9ZVB",control:"styles_control__kds9w",buttons:"styles_buttons__3vh4D",new:"styles_new__v6Lj7",music:"styles_music__3MWRH",submit:"styles_submit__3y_fb"}},30:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__3x4JJ","text-size-small":"styles_text-size-small__3ilNc","text-size-normal":"styles_text-size-normal__3uCp0","text-size-large":"styles_text-size-large__3IOUB","text-size-larger":"styles_text-size-larger__1p4Yf","text-bold":"styles_text-bold__2pl0G","text-uppercase":"styles_text-uppercase__1_bRr",auth:"styles_auth___R3bx",background:"styles_background__2A0gm",container:"styles_container__1o0Fe",header:"styles_header__3Rl2Y",wrapper:"styles_wrapper__3vit_",logo:"styles_logo__-42WF",text:"styles_text__27-Ab",links:"styles_links__cRX1V",link:"styles_link__dRYCs",button:"styles_button__1aIul",icon:"styles_icon__1ciK6"}},34:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__9ID4P","text-size-small":"styles_text-size-small__EuMrL","text-size-normal":"styles_text-size-normal__1OTia","text-size-large":"styles_text-size-large__3vK1o","text-size-larger":"styles_text-size-larger__28WhF","text-bold":"styles_text-bold__lZla8","text-uppercase":"styles_text-uppercase__bPdLp","thread-panel":"styles_thread-panel__1kB56",container:"styles_container__1lcW7",handle:"styles_handle__226hH",contents:"styles_contents__33G3C",title:"styles_title__24vsv",info:"styles_info__3NRDf",control:"styles_control__252yp","control-star":"styles_control-star__1c7pK","control-share":"styles_control-share__Pds8-","thread-previous":"styles_thread-previous__3lb-e","thread-next":"styles_thread-next__1cawo","thread-play":"styles_thread-play__2CtbI"}},35:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__2Z2H_","text-size-small":"styles_text-size-small__IjZsk","text-size-normal":"styles_text-size-normal__18x1M","text-size-large":"styles_text-size-large__2qn5H","text-size-larger":"styles_text-size-larger__1JRyu","text-bold":"styles_text-bold__tZ_OT","text-uppercase":"styles_text-uppercase___vsP3","head-nav":"styles_head-nav__2AjrA","nav-menu":"styles_nav-menu__2jGZn","nav-search":"styles_nav-search__1ar0n",switch:"styles_switch__E7v1U",stage:"styles_stage__22-Cl","stage-previous":"styles_stage-previous__2AVMx","stage-next":"styles_stage-next__3YrgJ"}},37:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__1tGX6","text-size-small":"styles_text-size-small__XG-Y3","text-size-normal":"styles_text-size-normal__7h11k","text-size-large":"styles_text-size-large__1CtPS","text-size-larger":"styles_text-size-larger__kXWo9","text-bold":"styles_text-bold__3mZlG","text-uppercase":"styles_text-uppercase__2hpgg",form:"styles_form__1DRsU",title:"styles_title__E5Js6",fields:"styles_fields__3JMkk",field:"styles_field__Fq61A",label:"styles_label__28JCJ",input:"styles_input__2KE-J",button:"styles_button__3sZj4"}},40:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__3CPzR","text-size-small":"styles_text-size-small__39sOw","text-size-normal":"styles_text-size-normal__39O6I","text-size-large":"styles_text-size-large__kZVIY","text-size-larger":"styles_text-size-larger__3d6xL","text-bold":"styles_text-bold__2tYsD","text-uppercase":"styles_text-uppercase__ESUnP","voice-info":"styles_voice-info__2Dqfq",profile:"styles_profile__3TdcI",like:"styles_like__ZTv0n",badge:"styles_badge__1ktpI",info:"styles_info__9gAry",date:"styles_date__1qg4x",user:"styles_user__3DtHt"}},43:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__289PS","text-size-small":"styles_text-size-small__3A4cv","text-size-normal":"styles_text-size-normal__3kkF7","text-size-large":"styles_text-size-large__3twJV","text-size-larger":"styles_text-size-larger__3S1MH","text-bold":"styles_text-bold__3S_vo","text-uppercase":"styles_text-uppercase__38Dsw","record-button":"styles_record-button__2zE4x",embedded:"styles_embedded__3pBIt",show:"styles_show__1kMSr",button:"styles_button__2Lhpx"}},53:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__19mQ2","text-size-small":"styles_text-size-small__3PFkO","text-size-normal":"styles_text-size-normal__30l_J","text-size-large":"styles_text-size-large__2YLkK","text-size-larger":"styles_text-size-larger__1CCYy","text-bold":"styles_text-bold__1ke-k","text-uppercase":"styles_text-uppercase__1FLP5",map:"styles_map__3B7Q2","tile-layer":"styles_tile-layer__1vgma",thread:"styles_thread__32bcF","new-thread":"styles_new-thread__1rYZt",popup:"styles_popup__3EyS_"}},54:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__2vnjx","text-size-small":"styles_text-size-small__3BLTI","text-size-normal":"styles_text-size-normal__3qJii","text-size-large":"styles_text-size-large__1ze8J","text-size-larger":"styles_text-size-larger__2z5Bx","text-bold":"styles_text-bold__1qn8k","text-uppercase":"styles_text-uppercase__2Z6AJ","timer-bar":"styles_timer-bar__1Pml3",timer:"styles_timer__1qpE0",second:"styles_second__TS7wI",centisecond:"styles_centisecond__BWWRt",colon:"styles_colon__1j3Cp"}},55:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__dLVMu","text-size-small":"styles_text-size-small__1T3RC","text-size-normal":"styles_text-size-normal__1JyEr","text-size-large":"styles_text-size-large__1Sx-k","text-size-larger":"styles_text-size-larger__2dcYQ","text-bold":"styles_text-bold__33hvE","text-uppercase":"styles_text-uppercase__XCFEW","audio-player":"styles_audio-player__1BJ2N",control:"styles_control__2-hO5",play:"styles_play__3vUqD",delete:"styles_delete__X0VW1","wave-form":"styles_wave-form__1A4Vl"}},61:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__2EeOw","text-size-small":"styles_text-size-small__2AMGP","text-size-normal":"styles_text-size-normal__364NK","text-size-large":"styles_text-size-large__DyhGv","text-size-larger":"styles_text-size-larger__2k4HR","text-bold":"styles_text-bold__2IahP","text-uppercase":"styles_text-uppercase__1Vqm5",left:"styles_left__3n6fV",container:"styles_container__1Hfy4",link:"styles_link__1BPDU",button:"styles_button__1SlMj"}},71:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__QdQq8","text-size-small":"styles_text-size-small__1ntVF","text-size-normal":"styles_text-size-normal__1QG0Q","text-size-large":"styles_text-size-large__60MzJ","text-size-larger":"styles_text-size-larger__1NDP3","text-bold":"styles_text-bold__2aWdQ","text-uppercase":"styles_text-uppercase__2HQOU","play-list":"styles_play-list__xoJ8L",open:"styles_open__24lEQ",voices:"styles_voices__32pWd",voice:"styles_voice__lsVyV"}},76:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__2F6gP","text-size-small":"styles_text-size-small__1wR6a","text-size-normal":"styles_text-size-normal__5a5fm","text-size-large":"styles_text-size-large__3Eqv1","text-size-larger":"styles_text-size-larger__3s-Ym","text-bold":"styles_text-bold__3Kuya","text-uppercase":"styles_text-uppercase__3KB3R",drawer:"styles_drawer__2CVKX","drawer-horizontal":"styles_drawer-horizontal__dx_0b"}},77:function(e,t,a){e.exports={"text-size-smaller":"styles_text-size-smaller__1fi0Z","text-size-small":"styles_text-size-small__PtZps","text-size-normal":"styles_text-size-normal__MAOk3","text-size-large":"styles_text-size-large__2FZ2E","text-size-larger":"styles_text-size-larger__2EDnl","text-bold":"styles_text-bold__37IFA","text-uppercase":"styles_text-uppercase__36vkr",main:"styles_main__3ZYez",loading:"styles_loading__syWmE"}},90:function(e,t,a){e.exports={app:"App_app__2ziFi"}},98:function(e,t,a){e.exports=a(123)}},[[98,1,2]]]);
//# sourceMappingURL=main.02ee537d.chunk.js.map